---
layout: post
title: "nAnt"
excerpt: "Not any tutorial, just unordered notes"
date: 2018-04-04
tags: [tech, nant, nantcontrib, installation, setup, buildfile]
categories: articles
comments: true
share: true
published: false
---

# A build tool for .NET and more

NAnt is a build tool for .NET application (based on [Ant](http://ant.apache.org/) for Java), that can help in building .NET application, run unit tests, do configuration etc.

* Free to use, and [open source](https://github.com/nant/nant)
* Runs on build files which are XML based, and has `.build` extension
* Workflow is created with a hierarchy of _"tasks"_
* It can run `NAnt` specific tasks, and any other command can be run with `<exec>` task, based on the `OS`

NAnt uses a number of open source third party libaries.  Recent versions are included included with the NAnt distribution, for example - [NUnit](https://sourceforge.net/projects/nunit/) for unit testing, [NDoc](http://ndoc.sourceforge.net/) for documentation, [SharpZipLib](http://www.icsharpcode.net/OpenSource/SharpZipLib/) for binary compression etc.

#### Installation

The working system must meet [system requirements](https://github.com/nant/nant#prerequisites).

NAnt has binary and source distributions. Binary is enough to setup and run builds. See details [here](http://nant.sourceforge.net/release/latest/help/introduction/installation.html).

* Download the current version from [here](http://nant.sourceforge.net/) - see "Releases" menu on the left, e.g. nant-0.92-bin.zip
* Extract the contents to a directory where you have access. e.g. _"C:\nant"_
* Add this path to _"System Environment PATH"_ for easy access. Once done, command `nant -help` should work
* In the same location (or some directory that is added to Environment Paths), add a batch file `nant.bat`, this will just work as a wrapper on `NAnt.exe`
* Add following command in the file and save

```bash
@echo off
"C:\nant\bin\NAnt.exe" %*
REM make sure your NAnt.exe path is correct
```

**Note:** The NAnt configuration is present in _"C:\nant\bin\NAnt.exe.config"_ (based on your installation path). You can check and change some configurations, if needed e.g. default .NET framework. Also, global properties can be set in this file.
{: .notice--info}

#### Build files

Each `NAnt` build file is an `XML` file with bunch of command and configuration.

* Files will have one `<project>` root element
* And one or more `<property>` and `<target>`
* A `<property>` is a avariable with name & value. Property name can include dot (.). The value of a property can be used as `${property.name}`
* Value of a property can be passed as command line argument while running NAnt. Properties can be set to be readonly by specifying `readonly="true"`
* A `<target>` is a single or set of tasks, with a name & optional `description` and other attributes. Generally, a `<target>` represents a step in the whole build process
* Target can optionally have `unless` or `if` attributes to control execution based on some condition. If `if` evaluates to `true`, the target executes, else that is skipped. The `unless` works the the opposite way ?
* The optional `depends` attribute creates a dependency on another target, such that current target will not run until that target is executed

Example - TO CHANGE <<

```xml
<?xml version="1.0"?>
<project name="Hello World" default="hello">
    <property name="user.string" value="AC" />
    <target name="hello" description="Echoes 'Hello _user_'">
        <echo message="Hello ${user.string}" />
    </target>
</project>
```

* NAnt looks for a file with `.build` extension. If there are more, it takes `default.build`. One can also specify `-buildfile:<build-filename>` command line argument
* The default `<target>` is specified as `default` attribute at `<project>` level, or it can be passed as runtime argument
* A `task` is just one command within a `<target>`. A task can do stuffs like creating or deleting a directory, building a set of C# files or projects, send email, calling another `target` etc. There is big bunch of useful tasks included in NAnt by default.
* Almost anything that can be run from the command line, can be executed with a `<exec>` task
* Each task has an optional `failonerror` boolean attribute which says where the build should fail on failure of this task or not. The dafault is to fail the build `failonerror="true"`
* Many more additional tasks are available with another tool [NAntContrib](http://nantcontrib.sourceforge.net/)
* Custom tasks can also be built. See the abstract base class [here](https://github.com/nant/nant/blob/master/src/NAnt.Core/Task.cs)
* Basic NAnt run options (assuming the build file is in directory c:\\builddirectory)

```bash
# single or default build file and default target
c:\\builddirectory>nant
# single or default build file with specific target
# can specify multiple targets, separated by space (?)
c:\\builddirectory>nant hello
# with specific build file and default target
c:\\builddirectory>nant -buildfile:hello.build
# with specific build file and specific target, can use -f: as well
c:\\builddirectory> nant -buildfile:hello.build hello
# passing a property value, enclose in quotes in value has spaces
c:\\builddirectory>nant -D:user.string=developers
```

**Note:** If no default target is mentioned in .build file and no target specified as command argument, NAnt will simply exit without doing anything.
{: .notice--danger}

#### Building a project

The `<csc>` task can be used to compile one or more C# files. Similar tasks are available for `VB`, `F#` etc. But, generaly we have `*.csproj` or `*.sln` files that defines the whole hierarchy of files, it's dependencies etc. There is a `<solution>` task that can directly build a solution or one or more project files.

**Note:** The `solution` task does not work for projects that created after VS2003. For that, best choice is the [msbuild task from NAntContrib](http://nantcontrib.sourceforge.net/release/0.85/help/tasks/msbuild.html)
{: .notice--info}

#### Installing NAntContrib

NAntContrib is another tool that adds lot of additional features (tasks) to the NAnt. One of the most useful one is the `msbuild` task .NET projects/solutions created with Visual Studio with version higher than 2003!

* Download the latest version from [here](http://nantcontrib.sourceforge.net/) - see "Releases" menu on the left, e.g. 0.92
* Download the required package, e.g. `nantcontrib-0.92-bin.zip`
* Save them in a directory with access, e.g. `C:\nantcontrib-0.92\bin`
* Now ideally you "should" be able to use it by adding a `<loadtasks>` in your build file with the location of the NAntContrib assemblies, like

```xml
<loadtasks>
    <fileset>
        <include name="C:/nantcontrib-0.92/bin/**/*.dll" />
    </fileset>
</loadtasks>
```

**Note:** You'll most probably get an error like "Failure scanning CollectionGen.dll for extensions. Could not load file or assembly 'Microsoft.VSDesigner, Version=7.0.3300.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' or one of its dependencies. The system cannot find the file specified."
{: .notice--danger}

 Here _**you'll need some weird wizard skills to make it work!!**_ There are two ways of getting it to work, none of which is clear from the documentations! Thanks to posts like [this](http://byatool.com/lessons/how-to-installusing-nantcontrib-because-the-documentation-sucks/) and [this](https://sourceforge.net/p/nantcontrib/bugs/84/) for the solution.

**Option 1:** Adding `<loadtasks>` to each main build file

1. Copy `CollectionGen.dll`, and the two `SLiNgshoT` assemblies in a new folder `bin\tasks`
2. Copy all the other (main) assemblies, including `NAnt.Contrib.Tasks` in a new folder `bin\lib`
3. Add `<loadtasks>` to the begining of your build file

```xml
<loadtasks>
    <fileset>
        <include name="C:/nantcontrib-0.92/bin/lib/**/*.dll" />
    </fileset>
</loadtasks>
```

**Option 2:** Adding NAntContrib tasks to NAnt default tasks list

1. Copy `CollectionGen.dll`, and the two `SLiNgshoT` assemblies in a new `tasks` folder inside `nant\bin` e.g. _"C:\nant\bin\tasks"_
2. Copy all the other (main) assemblies, including `NAnt.Contrib.Tasks` directly inside `nant\bin` e.g. _"C:\nant\bin"_
3. Now these tasks will be part of all the `nant` scripts by default

#### The 'msbuild' task

[msbuild] err or MSB4019: The imported project "C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v11.0\WebApplications\Microsoft.WebApplication.targets" was not found. Confirm that the path in the <Import> declaration is correct, and that the file exists on disk.

C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v10.0\WebApplications
to
C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v11.0\WebApplications

https://stackoverflow.com/questions/3980909/microsoft-webapplication-targets-was-not-found-on-the-build-server-whats-your

https://stackoverflow.com/questions/17433904/v11-0-webapplications-microsoft-webapplication-targets-was-not-found-when-file-a

#### References

* [NAnt help reference](http://nant.sourceforge.net/release/latest/help/)
* [NAntCOntrib](http://nantcontrib.sourceforge.net/)
* [NAnt fundamentals](http://nant.sourceforge.net/release/0.85/help/fundamentals/)
* Quick start articles on [4guysfromrolla](http://www.4guysfromrolla.com/articles/120104-1.aspx), [Code magazine](http://www.codemag.com/Article/0507081/Building-.NET-Applications-with-NAnt)